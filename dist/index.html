<!DOCTYPE HTML>
<html lang="en">
    <head>
        <title>manhattan-typeahead</title>
         <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
            integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
            crossorigin=""/>
        <link
            rel="stylesheet"
            type="text/css"
            href="http://localhost:5999/maps.css"
            >
    </head>
    <body>
        <form>
            <div>
                <label>
                    City<br>
                    <input type="text" name="city" value="bromyard">
                </label>
            </div>
            <div>
                <label>
                    Postcode<br>
                    <input type="text" name="postcode" value="hr74qf">
                </label>
            </div>

            <br>

            <div>
                <label>
                    Lat
                    <input type="text" name="lat" value="52.185766">
                </label>
                <label>
                    Lon
                    <input type="text" name="lon" value="-2.089655">
                </label>
            </div>

            <br>

            <div
                data-mh-map-field
                data-mh-map-field--geocode="geocode"
                data-mh-map-field--geocode-url="https://geocodeuk.com/api/v1/8b50-c487-ec89-3a6d-b968-5261-ec02-d47e/geocode"
                class="mh-map-field"
                ></div>

            <!--ul>
                <li data-mh-marker data-mh-marker--coords="52.185766,-2.089655">
                    <p>Getme</p>
                </li>
            </ul-->

            <h2>To do</h2>
            <ul>
                <li>Find button should perform an geo location lookup and update the marker position</li>
            </ul>

        </form>
        <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
            integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
            crossorigin=""></script>
        <script src="http://localhost:5999/index.js"></script>
        <script>
            var mapElm = document.querySelector('[data-mh-map-field]');
            var map = new ManhattanMaps.MapField(mapElm);

            function geocode(mapField, location, callback) {
                var url = mapField.geocodeUrl + '?q=' + location;

                // Set up the request
                var xhr = new XMLHttpRequest()
                xhr.addEventListener('load', function (ev) {
                    // Extract the items from the JSON response
                    response = JSON.parse(ev.target.responseText)

                    if(response.status === 'success') {
                        callback(response.matches[0].point)
                    } else {
                        callback(null)
                    }
                });

                // Send the request
                xhr.open('GET', url);
                xhr.send(null);
            }

            ManhattanMaps.MapField.behaviours.geocode.geocode = geocode;

        </script>
    </body>
</html>